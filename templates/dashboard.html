<!-- save as dashboard.html (Jinja template) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Feed — Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* same CSS from your original file */
    :root{
      --bg:#f6f8fa;
      --card:#ffffff;
      --muted:#97a0ad;
      --accent:#2ea3ff;
      --soft-shadow: 0 8px 30px rgba(14,30,37,0.06);
      --soft-inset: 0 2px 0 rgba(255,255,255,0.6);
      --radius:14px;
      --maxwidth:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      background:linear-gradient(180deg,#f8fbff 0%,var(--bg) 100%);
      display:flex;
      justify-content:center;
      padding:30px;
      color:#182026;
    }
    .wrap{width:100%;max-width:var(--maxwidth);display:grid;grid-template-columns:240px 1fr 320px;gap:28px;align-items:start}
    .left{background:transparent;position:sticky;top:28px;height:calc(100vh - 56px);display:flex;flex-direction:column;gap:18px}
    .brand{display:flex;align-items:center;gap:10px;padding:8px 6px}
    .brand .logo{width:34px;height:34px;border-radius:6px;background:linear-gradient(135deg,#2ea3ff,#6ad1ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    .nav{background:transparent;padding:10px;border-radius:12px;display:flex;flex-direction:column;gap:10px}
    .nav a{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;color:var(--muted);text-decoration:none;font-weight:500}
    .nav a.active{background:linear-gradient(90deg,#f0f7ff,#fbfdff);box-shadow:var(--soft-shadow);color:#1976d2}
    .nav a:hover{background:#fff;border-radius:12px;color:#1976d2}
    .center{position:relative}
    .composer{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--soft-shadow);margin-bottom:22px}
    .composer .top{display:flex;gap:12px;align-items:flex-start}
    .avatar{width:48px;height:48px;border-radius:50%;background:#ddd;flex:0 0 48px;overflow:hidden}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .composer textarea{width:100%;border:0;outline:none;resize:none;font-size:15px;padding:8px 10px;background:transparent;min-height:56px;color:#223344}
    .composer .actions{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    .btn{background:var(--accent);color:white;padding:10px 14px;border-radius:10px;border:0;font-weight:600;box-shadow:var(--soft-inset);cursor:pointer}
    .post{background:var(--card);border-radius:var(--radius);box-shadow:var(--soft-shadow);padding:20px;margin-bottom:20px;overflow:visible}
    .post .meta{display:flex;align-items:center;gap:12px}
    .post .meta .name{font-weight:700;color:#0f3b57}
    .post .meta .role{color:var(--muted);font-size:13px;margin-left:8px}
    .post .body{margin-top:12px;color:#495b66;line-height:1.6}
    .post .card-media{margin-top:14px;background:#f6f8fa;border-radius:10px;padding:12px;display:flex;gap:12px;align-items:center}
    .post .card-media img{width:140px;height:92px;object-fit:cover;border-radius:8px;flex-shrink:0}
    .post .card-media .media-meta{font-size:13px;color:#6b7b86}
    .post .post-actions{display:flex;gap:18px;margin-top:14px;color:var(--muted);font-weight:600}
    .right{position:sticky;top:28px;height:calc(100vh - 56px);display:flex;flex-direction:column;gap:18px}
    .widget{background:var(--card);border-radius:12px;padding:16px;box-shadow:var(--soft-shadow);margin-top: 30px;}
    .widget h4{Margin:0 0 8px 0;font-size:15px;color:#183046}
    .sponsored img{width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:30px}
    .people-list{display:flex;flex-direction:column;gap:10px}
    .people-list .person{display:flex;align-items:center;gap:12px}
    .person .pimg{width:40px;height:40px;border-radius:50%;overflow:hidden}
    .person .pimg img{width:100%;height:100%;object-fit:cover}
    .person .ptxt{font-size:14px}
    .profile-card{text-align:center;padding:22px;border-radius:12px}
    .profile-card img{width:92px;height:92px;border-radius:50%;border:6px solid #fff;margin-top:-64px;box-shadow:0 6px 24px rgba(14,30,37,0.08)}
    .connect-btn{margin-top:12px;background:linear-gradient(90deg,#2ea3ff,#59c1ff);color:white;padding:10px;border-radius:999px;border:0;cursor:pointer;font-weight:700}
    .progress-wrap{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg,#ffffff,#fbfdff);box-shadow:var(--soft-shadow)}
    .circle{width:86px;height:86px;border-radius:50%;background:conic-gradient(#2ea3ff var(--p,75%), #e9eef3 0%);display:flex;align-items:center;justify-content:center;font-weight:700;color:#2b3b44}
    .progress-text{font-size:13px;color:var(--muted)}
    @media (max-width:1100px){.wrap{grid-template-columns:200px 1fr;gap:18px}.right{display:none}}
    @media (max-width:700px){.wrap{grid-template-columns:1fr; padding:0 12px;}.left{display:flex;flex-direction:row;gap:8px;overflow:auto;height:auto}.left .nav{flex-direction:row}.left .nav a{white-space:nowrap;padding:8px}}
    .muted{color:var(--muted);font-size:13px}

    /* ---------- ADDED: reusable avatar image class ---------- */
    .avatar-img{
      width:120px;            /* avatar diameter */
      height:120px;
      border-radius:50%;
      object-fit:cover;
      display:block;
      border:6px solid #fff;  /* matches profile-card style */
      box-shadow:0 6px 24px rgba(14,30,37,0.08);
      margin-bottom:10px;
    }
    .profile-btn {
  margin-top: 14px;
  background: linear-gradient(90deg, #2ea3ff, #59c1ff);
  color: white;
  padding: 10px 18px;
  border-radius: 999px;
  border: 0;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(14,30,37,0.12);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.profile-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(14,30,37,0.18);
}
/* Background image */
    .bg-image {
      position: absolute;
      inset: 0;
      z-index: 0;
      background-image: url('/static/loginbg.jpg');
      background-size: cover;
      background-position: center;
    }

    /* Overlay with gradient */
    .overlay {
      position: absolute;
      inset: 0;
      z-index: 1;
      background: linear-gradient(to bottom, #33a9d88e, #16c6b781);
}
    /* you can override size where needed by wrapping or using inline styles */
    /* ------------------------------------------------------- */
  </style>
</head>
<body>
  <div class="wrap">

    <!-- LEFT -->
    <aside class="left">
      <div class="brand">
        <div class="logo">S</div>
        <div style="font-weight:700">Sporture</div>
      </div>

     <div class="nav">
      <a class="active" href="feed.html">Feed</a>
      <a href="/application">Applications</a>
    </div>

      <div style="flex:1"></div>

      <div class="widget progress-wrap">
        <div class="circle" id="profileCircle" style="--p: {{ profile_pct }}%">{{ profile_pct }}%</div>
        <div class="progress-text">
          <div style="font-weight:700">{{ profile_pct }}% COMPLETE</div>
          <div class="muted" style="margin-top:8px">Add achievements to boost your profile visibility</div>
          <a href="#" class="muted" style="display:inline-block;margin-top:8px;color:var(--accent);font-weight:700;text-decoration:none">Complete profile</a>
        </div>
      </div>
    </aside>

    <!-- CENTER -->
    <main class="center">

      <!-- composer -->
      <div class="composer" id="composer">
        <div class="top">
          <!-- keep structure but add data-seed so JS can map to the vecteezy avatars -->
          <div class="avatar"><img data-seed="{{ display_name|e }}" src="{{ avatar_url }}" alt=""></div>
          <div style="flex:1">
            <textarea id="postText" placeholder="Share your achievement or opportunity..."></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="postBtn">Post →</button>
              <div style="display:flex;gap:8px;align-items:center;margin-left:8px;color:var(--muted)">
                <span style="font-weight:600">Update the community</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- feed -->
      <div id="feed">
        <!-- Athlete post -->
        <article class="post">
          <div class="meta">
            <div class="avatar" style="width:56px;height:56px"><img data-seed="Rahul Mehta" src="https://randomuser.me/api/portraits/men/45.jpg" alt=""></div>
            <div>
              <div><span class="name">Rahul Mehta</span> <span class="role muted">— Athlete (Boxing)</span></div>
              <div class="muted" style="font-size:13px;margin-top:6px">1d • Verified Athlete</div>
            </div>
          </div>
          <div class="body">
            Excited to share that I won Gold in the State Boxing Championship 🥇. Looking for sponsorship to prepare for Nationals!
          </div>
          <div style="display:flex;justify-content:flex-end;margin-top:10px">
            <div style="background:#fff;padding:8px 12px;border-radius:999px;box-shadow:var(--soft-shadow);font-weight:700;color:var(--muted)">Sponsor ➜</div>
          </div>
        </article>

        <!-- Sponsor post -->
        <article class="post">
          <div class="meta">
            <div class="avatar" style="width:56px;height:56px"><img data-seed="Neha Kapoor" src="https://randomuser.me/api/portraits/women/60.jpg" alt=""></div>
            <div>
              <div><span class="name">Neha Kapoor</span> <span class="role muted">— Sponsor, Nike India</span></div>
              <div class="muted" style="font-size:13px;margin-top:6px">2d</div>
            </div>
          </div>

          <div class="body">
            We are looking to support young athletes in athletics and basketball 🏀. Verified athletes can apply through Sporture.
          </div>

          <div class="card-media">
            <img src="https://images.unsplash.com/photo-1521412644187-c49fa049e84d?w=900&q=60" alt="">
            <div class="media-meta">
              <div style="font-weight:700;color:#0f3b57">Nike Rising Stars Program</div>
              <div class="muted" style="margin-top:8px">Helping athletes achieve their dreams through financial and training support.</div>
              <div class="muted" style="margin-top:10px;font-size:12px">Deadline: Oct 30, 2025</div>
            </div>
          </div>

          <div class="post-actions">
            <div>Like</div>
            <div>Comment</div>
            <div>Apply</div>
          </div>
        </article>

        <!-- Coach post -->
        <article class="post">
          <div class="meta">
            <div class="avatar" style="width:56px;height:56px"><img data-seed="Coach Arjun" src="https://randomuser.me/api/portraits/men/52.jpg" alt=""></div>
            <div>
              <div><span class="name">Coach Arjun</span> <span class="role muted">— Athletics Coach</span></div>
              <div class="muted" style="font-size:13px;margin-top:6px">3d</div>
            </div>
          </div>

          <div class="body">
            I’m opening slots for 5 athletes preparing for international trials. Training includes nutrition, fitness, and personalized coaching. DM to apply!
          </div>
          <div class="post-actions">
            <div>Like</div>
            <div>Comment</div>
            <div>Contact</div>
          </div>
        </article>
      </div>
    </main>

    <!-- RIGHT -->
    <aside class="right">
      <div class="widget sponsored">
        <!-- changed: sponsored image is now rendered as a circular avatar -->
        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=900&q=60" alt="Sponsored avatar" class="avatar-img">
        <h4 class="muted">Sponsored</h4>
        <div style="font-weight:700">Adidas Young Champs</div>
        <div class="muted" style="margin-top:8px;font-size:13px">Scholarships for under-18 athletes across India. Apply today!</div>
      </div>

      <div class="widget">
        <h4>Athletes you may know</h4>
        <div class="people-list">
          <div class="person"><div class="pimg"><img src="https://randomuser.me/api/portraits/men/31.jpg" alt=""></div><div class="ptxt"><strong>Amit Sharma</strong><div class="muted">Sprinter</div></div></div>
          <div class="person"><div class="pimg"><img src="https://randomuser.me/api/portraits/women/44.jpg" alt=""></div><div class="ptxt"><strong>Pooja Reddy</strong><div class="muted">Badminton Player</div></div></div>
          <div class="person"><div class="pimg"><img src="https://randomuser.me/api/portraits/men/32.jpg" alt=""></div><div class="ptxt"><strong>Karan Verma</strong><div class="muted">Swimmer</div></div></div>
        </div>
      </div>

<div class="widget profile-card">
  <div class="profile-header"></div>
  <img 
    data-seed="{{ display_name|e }}" 
    src="{{ avatar_url }}" 
    alt="{{ display_name }}'s avatar" 
    class="avatar-img"
  >
  <h4 style="margin:12px 0 4px 0">{{ display_name }}</h4>
  <div class="muted">Profile Complete</div>
  <button class="profile-btn">Update Profile</button>
</div>



    </aside>

  </div>

  <script>
    // list of local avatar paths (preferred). Adjust path if your static folder differs.
    const hostedAvatars = [
      '/static/p1.jpg', // vecteezy avatar 1 (spectacles guy)
      '/static/p2.webp', // vecteezy avatar 2 (cheerful with glasses)
      '/static/p3.webp'  // vecteezy avatar 3 (blonde woman)
    ];

    // fallback image generator (DiceBear) in case local files aren't available
    function dicebear(seed) {
      return `https://avatars.dicebear.com/api/identicon/${encodeURIComponent(seed || 'anon')}.svg?scale=85`;
    }

    // simple string -> integer hash (deterministic)
    function strHash(s) {
      let h = 2166136261 >>> 0;
      for (let i = 0; i < s.length; i++) {
        h ^= s.charCodeAt(i);
        h = Math.imul(h, 16777619) >>> 0;
      }
      return h >>> 0;
    }

    // choose an avatar index from seed
    function avatarIndexForSeed(seed, count) {
      const h = strHash(seed || 'anon');
      return h % count;
    }

    // attempt to load a hosted avatar (returns Promise that resolves to URL that worked)
    function probeAvatar(url) {
      return new Promise(resolve => {
        const img = new Image();
        img.onload = () => resolve(url); // exists & loaded
        img.onerror = () => resolve(null); // not found or blocked
        img.src = url;
      });
    }

    // Set avatars for all <img data-seed="..."> elements
    async function applyVecteezyAvatars() {
      // pre-check which hosted avatars actually load (some servers block hotlink).
      const checks = await Promise.all(hostedAvatars.map(u => probeAvatar(u)));
      const available = checks.map((v,i) => v ? hostedAvatars[i] : null);

      // If none available, we'll use dicebear as fallback
      const imgs = document.querySelectorAll('img[data-seed]');
      imgs.forEach(img => {
        const seed = img.getAttribute('data-seed') || '{{ display_name|e }}' || 'anon';
        let chosenUrl = null;

        // pick index deterministically
        const idx = avatarIndexForSeed(seed, hostedAvatars.length);
        if (available[idx]) {
          chosenUrl = available[idx];
        } else {
          // if chosen local not available, attempt to pick any available local image (first found)
          const anyLocal = available.find(v => v);
          chosenUrl = anyLocal || dicebear(seed);
        }

        img.src = chosenUrl;
        if(!img.alt || img.alt.trim() === '') img.alt = `Avatar for ${seed}`;
      });
    }

    // Posting: when a user posts, use the same deterministic avatar as their profile
    function avatarForSeedSync(seed) {
      // choose local if available synchronously (we can't probe here sync) — prefer path index
      const idx = avatarIndexForSeed(seed, hostedAvatars.length);
      // return hosted path (may 404), but DOM script will already have set working ones on load
      return hostedAvatars[idx] || dicebear(seed);
    }

    // Posting logic (keeps your markup)
    const postBtn = document.getElementById('postBtn');
    const postText = document.getElementById('postText');
    const feed = document.getElementById('feed');
    const loggedInSeed = '{{ display_name|e }}'; // use user_id if you prefer stable mapping

    postBtn.addEventListener('click', () => {
      const text = postText.value.trim();
      if(!text) return alert('Write something first 🙂');

      const myAvatar = avatarForSeedSync(loggedInSeed);

      const article = document.createElement('article');
      article.className = 'post';
      article.innerHTML = `
        <div class="meta">
          <div class="avatar" style="width:56px;height:56px"><img src="${myAvatar}" alt=""></div>
          <div>
            <div><span class="name">{{ display_name }}</span> <span class="role muted">— {{ role_label }}</span></div>
            <div class="muted" style="font-size:13px;margin-top:6px">Just now</div>
          </div>
        </div>
        <div class="body">${escapeHtml(text)}</div>
        <div class="post-actions">
          <div>Like</div>
          <div>Comment</div>
          <div>Share</div>
        </div>
      `;
      feed.insertBefore(article, feed.firstChild);
      postText.value = '';
    });

    function escapeHtml(str){
      return str.replace(/[&<>"'`=\/]/g, function(s){
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'})[s];
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      applyVecteezyAvatars();
    });
  </script>
</body>
</html>
